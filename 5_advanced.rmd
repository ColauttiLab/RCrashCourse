---
title: |-
  R Crash Course \
   Part 5 -- Advanced Techniques
author: "Rob Colautti"
---

# 1. Introduction to Data Science

Data Science is a relativley new field of study that merges computer science and statistics with other domains of knowledge (e.g. business, biology, psychology). Data Science as a discipline has grown in popularity in response to the rapid rate of increase in data collection and publication. 

In biology, it can be helpful to think of data science as a continuous life-cycle:

## Data Science Life-Cycle

1. **Hypothesis Generation** -- Making observations that lead to testable hypotheses
2. **Data Collection** -- This may involve taking measurements yourself, manually entering data that is not yet in electronic format, requesting data from authors of published studies, or importing data from online sources. Collecting data is a crucial step that is often done poorly. Some tips on this are provided in a [paper by Wu et al](https://www.biorxiv.org/content/early/2018/10/30/457051)
3. **Data Cleaning** -- Investigate the data for quality assurance, to identify and fix potential errors. Start to visualize the data to look for outliers or nonsensical relationships (or lack thereof).
4. **Data Exploration** -- Try to understand the data, where they come from, and potential limitations on their use. Continue visualizing data; this may cause you to modify your hypotheses slightly.
5. **Modelling** -- Now that hypotheses are clearly defined, apply statistical tests of their validity.
6. **Report** -- Use visualizations along with the results of your statistical tests to summarize your findings.
7. Return to step 1.

In this tutorial, we focus mainly on coding in R for steps 2, 3, and 6. Step 5 requires a firm understanding of statistics. Step 4 is covered in the tutorials on [qplot](./2_qplot.html) and [ggplot](./3_ggplot.html). Step 1 is everything covered in a typical degree in the biological sciences. 

Before continuing, you should read the paper by [Wu et al](https://www.biorxiv.org/content/early/2018/10/30/457051). called "baRcodeR with PyTrackDat: Open-source labelling and tracking of biological samples for repeatable science." Pay particular attention to the '*Data Standards*' section. The *baRcodeR* and *PyTrackDat* programs and their application to current projects may also be of interest.

## Further Reading

The book [R for Data Science](http://shop.oreilly.com/product/0636920034407.do) by Hadley Wickham & Garrett Grolemund is an excellent resource using R in Data Science projects. 

In general, any book by Hadley Wickham is worth reading if you want to learn R.

# 2. Data Collection & Cleaning

The `dplyr` library in R has many useful features for importing and reorganizing your data for steps 2, 3 and 4 in the Data Science life-cycle outlined above. Don't forget to install the `dplyr` library and load it into memory.

```{r,echo=F,message=FALSE}
library(dplyr)
```

We'll work with our FallopiaData.csv dataset, and remind ourselves of the structure of the data

```{r}
Fallo<-read.csv("FallopiaData.csv")
str(Fallo)
```

## `filter()` -- Subset observations based on value

```{r}
Pot1<-filter(Fallo,PotNum==1)
head(Pot1)
```






# 1. Custom functions

## General form:
```{r,eval=FALSE}
functionName<-function(var1=Default1,var2=Default2){
  ## Meat and potatoes script
}
```

## Example function
User inputs two objects; the function outputs a list of functions applied to the inputs
```{r}
my.function<-function(var1=0,var2=0){
  # You can make new variables within a function
  add<-var1+var2
  subt<-var1-var2
  mult<-var1*var2
  div<-var1/var2  
  outlist<-list(input1=var1,input2=var2,addition=add,subtraction=subt,multiplication=mult,division=div)
  # So far, everything is contained within the function. 
  # Use return() to generate output
  return(outlist)
}
```
Note: Nothing output when the funciton is run. This just loads the function into memory.

### Run the function
```{r}
my.function(var1=10,var2=0.1)
my.function(var1=c(1:10),var2=c(10:1))
```

#### Protip #1:
Consider annotating long or complex script with cat() to help with troubleshooting

Note: \n = new line
```{r}
my.function<-function(var1=0,var2=0,verbose=FALSE){
  cat("\nInput variables:\nvar1 =",var1,"\nvar2 =",var2,"\n")
  cat("\nCalculating functions...\n")
  cat("\nAdding...\n")    

  add<-var1+var2
  
  cat("\nSubtracting...\n")

  subt<-var1-var2
  
  cat("\nMultiplying...\n")
  
  mult<-var1*var2
  
  cat("\nDividing...\n")
  
  div<-var1/var2  
  
  cat("\nGenerating output...\n\n")
  
  outlist<-list(input1=var1,input2=var2,addition=add,subtraction=subt,multiplication=mult,division=div)

  return(outlist)
}

## Run
my.function(var1=10,var2=0.1)
```

#### Better yet, make it an option:
```{r}
my.function<-function(var1=0,var2=0,verbose=FALSE){
  if (verbose==T){
    cat("\nInput variables:\nvar1 =",var1,"\nvar2 =",var2,"\n")
    cat("\nCalculating functions...\n")
    cat("\nAdding...\n")    
  }
  
  add<-var1+var2
  
  if (verbose==T){
    cat("\nSubtracting...\n")
  }
  
  subt<-var1-var2
  
  if (verbose==T){
    cat("\nMultiplying...\n")
  }
  
  mult<-var1*var2
  
  if (verbose==T){
    cat("\nDividing...\n")
  }
  
  div<-var1/var2  
  
  if (verbose==T){
    cat("\nGenerating output...\n")
  }
  
  outlist<-list(input1=var1,input2=var2,addition=add,subtraction=subt,multiplication=mult,division=div)

  return(outlist)
}

# Run
my.function(var1=10,var2=0.1,verbose=FALSE)
my.function(var1=10,var2=0.1,verbose=TRUE)
```


#### Protip #2:
If you have a custom function, theme, script, etc., that you use repeatedly:

  1. Save in a separate file
  
  * e.g. make new "myfunction.R" file containing just my.function
  
  2. Load using `source("PathName.FileName.R")`

  * e.g. `source("C:/Users/Colautti/Documents/RFunctions/myfunction.R")` if save

#### Protip #3:
We have already been using functions that somebody else wrote in R.

To see 'under the hood' type a function without the bracktes:

```{r}
my.function
library(ggplot2)
qplot
```

<br>

***

<br>

# 2. R Markdown

In RStudio: File->New->R Markdown
Choose html or Word (trivial to switch later)
PDF requires LaTeX

> NOTE: If you don't see an option for R Markdown, you may need to install it:

```{r,eval=FALSE}
install.packages("rmarkdown")
```


Very few elements are needed for a basic markdown file

## YAML Header 

This generated automatically when you make a new .Rmd file in RStudio. 
```{r,eval=FALSE}
---
title: R Crash Course
author: "Rob Colautti"
date: "Thursday, February 18, 2016"
output: word_document
---
```

## Basic elements:

embed R code inline using \` characters: \``embedded code`\`

Or block code using:

\`\`\`\{r\}
```{r,eval=FALSE}
block code
```
\`\`\`

For formatting text, see:

http://rmarkdown.rstudio.com/authoring_basics.html

A quick cheat-sheet is nice to have printed out for reference:

https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf

## Updates:

Update to latest version of rmarkdown
```{r, eval=FALSE}
devtools::install_github("rstudio/rmarkdown")
```

## Options for header
```{r eval=FALSE}
output:
  html_document: # Add options for html output
    toc: true # Add table of contents (TOC)
    number_sections: true # Add section numbers
    toc_float: # Have TOC floating at the side, rather than at the beginning
      collapsed: false # Expand subsections
```

## Content as tabs
```{r eval=FALSE}
## Quarterly Results {.tabset}

### By Product

(tab content)

### By Region

(tab content)
```

Looks like this:

## Quarterly Results {.tabset}

### By Product

(tab content)

### By Region

(tab content)


## Equations

Insert equations using LaTeX. Here is a handy [cheat sheet](./latexsheet.pdf)

For example:
```{r eval=FALSE}
$$\idotsint_V \mu(u_1,\dots,u_k) \,du_1 \dots du_k$$ 
$$\sum_{n=1}^{\infty} 2^{-n} = 1$$ 
```

$$\idotsint_V \mu(u_1,\dots,u_k) \,du_1 \dots du_k$$ 

$$\sum_{n=1}^{\infty} 2^{-n} = 1$$ 

Or inline:

```{r eval=FALSE}
Product $\prod_{i=a}^{b} f(i)$ inside text
```

Product $\prod_{i=a}^{b} f(i)$ inline with text

<br>

***

<br>

# 3. Custom packages

The comprehensive source on custom packages:

http://r-pkgs.had.co.nz/

(Hadley Wickham again)

### Install latest version of R
#### Important:
Quit R Studio before installing latest version of R

Download here:

https://cran.r-project.org/bin/windows/base/

### Install packages
```{r, eval=FALSE}
install.packages(c("devtools", "roxygen2", "testthat", "knitr"))
```


### Check installation
Make sure you have installed the preview version of R Studio

The following should return 'TRUE'
```{r, eval=F}
install.packages("rstudioapi")
rstudioapi::isAvailable("0.99.149")
```
If you see 'FALSE', try re-installing the preview version

http://www.rstudio.com/products/rstudio/download/preview/

### Keep devtools up to date
```{r, eval=F}
install.packages("curl")
devtools::install_github("hadley/devtools")
```

### Check library
```{r, eval=F}
library(devtools)
has_devel()
```

### Use RStudio
RStudio 'projects' make it easy to make a new package

  1. File-->New Project

  2. --> New Directory
  
  3. --> R Package
  
  4. --> Add files (data, scripts, function, theme, etc.)
  
  5. Give it a name: e.g. 'myFirstPackage'
  
### Modify files:
See 'Files' tab of R Studio

  1. myFirstPackage.proj
  
  2. DESCRIPTION
  
  3. Vignettes folder -- contains custom R markdown files
      
  4. Data in main folder; no need to setwd()
  
  
### Basic package complete!

#### Before going public:

  1. Create a github repository
  
  2. Flesh out documentation and meta-data
  
  3. Error checking
  
  4. Other tips:  http://r-pkgs.had.co.nz/release.html







